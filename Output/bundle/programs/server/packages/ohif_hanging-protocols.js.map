{"version":3,"sources":["meteor://ðŸ’»app/packages/ohif:hanging-protocols/both/namespace.js","meteor://ðŸ’»app/packages/ohif:hanging-protocols/both/collections.js","meteor://ðŸ’»app/packages/ohif:hanging-protocols/both/schema.js","meteor://ðŸ’»app/packages/ohif:hanging-protocols/both/hardcodedData.js","meteor://ðŸ’»app/packages/ohif:hanging-protocols/both/testData.js","meteor://ðŸ’»app/packages/ohif:hanging-protocols/both/classes/Protocol.js","meteor://ðŸ’»app/packages/ohif:hanging-protocols/both/classes/Rule.js","meteor://ðŸ’»app/packages/ohif:hanging-protocols/both/classes/Stage.js","meteor://ðŸ’»app/packages/ohif:hanging-protocols/both/classes/Viewport.js","meteor://ðŸ’»app/packages/ohif:hanging-protocols/both/classes/ViewportStructure.js","meteor://ðŸ’»app/packages/ohif:hanging-protocols/both/classes/rules/ImageMatchingRule.js","meteor://ðŸ’»app/packages/ohif:hanging-protocols/both/classes/rules/ProtocolMatchingRule.js","meteor://ðŸ’»app/packages/ohif:hanging-protocols/both/classes/rules/SeriesMatchingRule.js","meteor://ðŸ’»app/packages/ohif:hanging-protocols/both/classes/rules/StudyMatchingRule.js","meteor://ðŸ’»app/packages/ohif:hanging-protocols/both/lib/comparators.js","meteor://ðŸ’»app/packages/ohif:hanging-protocols/both/lib/removeFromArray.js","meteor://ðŸ’»app/packages/ohif:hanging-protocols/server/collections.js"],"names":["HP","HangingProtocols","Meteor","Collection","_debugName","allow","insert","update","remove","isDevelopment","isServer","startup","module","watch","require","attributeDefaults","abstractPriorValue","displaySettings","invert","id","text","defaultValue","options","studyAttributes","protocolAttributes","seriesAttributes","instanceAttributes","getDefaultProtocol","protocol","Protocol","locked","oneByOne","ViewportStructure","rows","columns","viewport","Viewport","first","Stage","viewports","push","stages","defaultProtocol","getMRTwoByTwoTest","proto","studyInstanceUid","ProtocolMatchingRule","equals","value","addProtocolMatchingRule","oneByTwo","left","right","firstSeries","SeriesMatchingRule","secondSeries","thirdImage","ImageMatchingRule","seriesMatchingRules","imageMatchingRules","twoByOne","left2","right2","fourthSeries","fifthSeries","second","testProtocol","getDemoProtocols","demoProtocols","v","Random","OHIF","removeFromArray","constructor","name","hasUpdatedPriorsInformation","createdDate","Date","modifiedDate","user","userLoggedIn","createdBy","getUserId","modifiedBy","availableTo","Set","editableBy","protocolMatchingRules","numberOfPriorsReferenced","getNumberOfPriorsReferenced","skipCache","forEach","stage","studyMatchingRules","rule","priorsReferenced","updateNumberOfPriorsReferenced","protocolWasModified","fromObject","input","ruleObject","stageObject","createClone","currentProtocol","Object","assign","clonedProtocol","addStage","removeProtocolMatchingRule","wasRemoved","export","Rule","comparators","EQUALS_REGEXP","attribute","constraint","required","weight","undefined","_constraintInfo","_validatorAndValue","getConstraintInfo","constraintInfo","ruleConstraint","keys","find","comparator","isRuleForPrior","ruleValidatorAndValue","getConstraintValidatorAndValue","validator","intValue","parseInt","test","validatorAndValue","currentValidator","constraintValidator","validatorOption","constraintValue","viewportStructure","currentStage","clonedStage","viewportObject","viewportSettings","StudyMatchingRule","removeRule","array","type","properties","getLayoutTemplateName","getNumViewports","description","freeze","_","length","index","isEqual","indexToRemove","splice","publish"],"mappings":"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","file":"/packages/ohif_hanging-protocols.js","sourcesContent":["HP = {};\r\n","HangingProtocols = new Meteor.Collection('hangingprotocols');\r\nHangingProtocols._debugName = 'HangingProtocols';\r\n\r\nHangingProtocols.allow({\r\n    insert: function() {\r\n        return true;\r\n    },\r\n    update: function() {\r\n        return true;\r\n    },\r\n    remove: function() {\r\n        return true;\r\n    }\r\n});\r\n\r\n// @TODO: Remove this after stabilizing ProtocolEngine\r\nif (Meteor.isDevelopment && Meteor.isServer) {\r\n    Meteor.startup(() => {\r\n        HangingProtocols.remove({});\r\n    });\r\n}\r\n","// @TODO start using namespace instead\r\n\r\n// Base classes\r\nimport './classes/Protocol';\r\nimport './classes/Stage';\r\nimport './classes/Viewport';\r\nimport './classes/ViewportStructure';\r\n\r\n// Specialized Rule classes\r\nimport './classes/rules/ProtocolMatchingRule';\r\nimport './classes/rules/StudyMatchingRule';\r\nimport './classes/rules/SeriesMatchingRule';\r\nimport './classes/rules/ImageMatchingRule';\r\n","HP.attributeDefaults = {\r\n    abstractPriorValue: 0\r\n};\r\n\r\nHP.displaySettings = {\r\n    invert: {\r\n        id: 'invert',\r\n        text: 'Show Grayscale Inverted',\r\n        defaultValue: 'NO',\r\n        options: ['YES', 'NO']\r\n    }\r\n};\r\n\r\n// @TODO Fix abstractPriorValue comparison\r\nHP.studyAttributes = [{\r\n    id: 'x00100020',\r\n    text: '(x00100020) Patient ID'\r\n}, {\r\n    id: 'x0020000d',\r\n    text: '(x0020000d) Study Instance UID'\r\n}, {\r\n    id: 'x00080020',\r\n    text: '(x00080020) Study Date'\r\n}, {\r\n    id: 'x00080030',\r\n    text: '(x00080030) Study Time'\r\n}, {\r\n    id: 'x00081030',\r\n    text: '(x00081030) Study Description'\r\n}, {\r\n    id: 'abstractPriorValue',\r\n    text: 'Abstract Prior Value'\r\n}];\r\n\r\nHP.protocolAttributes = [{\r\n    id: 'x00100020',\r\n    text: '(x00100020) Patient ID'\r\n}, {\r\n    id: 'x0020000d',\r\n    text: '(x0020000d) Study Instance UID'\r\n}, {\r\n    id: 'x00080020',\r\n    text: '(x00080020) Study Date'\r\n}, {\r\n    id: 'x00080030',\r\n    text: '(x00080030) Study Time'\r\n}, {\r\n    id: 'x00081030',\r\n    text: '(x00081030) Study Description'\r\n}, {\r\n    id: 'anatomicRegion',\r\n    text: 'Anatomic Region'\r\n}];\r\n\r\nHP.seriesAttributes = [{\r\n    id: 'x0020000e',\r\n    text: '(x0020000e) Series Instance UID'\r\n}, {\r\n    id: 'x00080060',\r\n    text: '(x00080060) Modality'\r\n}, {\r\n    id: 'x00200011',\r\n    text: '(x00200011) Series Number'\r\n}, {\r\n    id: 'x0008103e',\r\n    text: '(x0008103e) Series Description'\r\n}, {\r\n    id: 'numImages',\r\n    text: 'Number of Images'\r\n}];\r\n\r\nHP.instanceAttributes = [{\r\n    id: 'x00080016',\r\n    text: '(x00080016) SOP Class UID'\r\n}, {\r\n    id: 'x00080018',\r\n    text: '(x00080018) SOP Instance UID'\r\n}, {\r\n    id: 'x00185101',\r\n    text: '(x00185101) View Position'\r\n}, {\r\n    id: 'x00200013',\r\n    text: '(x00200013) Instance Number'\r\n}, {\r\n    id: 'x00080008',\r\n    text: '(x00080008) Image Type'\r\n}, {\r\n    id: 'x00181063',\r\n    text: '(x00181063) Frame Time'\r\n}, {\r\n    id: 'x00200060',\r\n    text: '(x00200060) Laterality'\r\n}, {\r\n    id: 'x00541330',\r\n    text: '(x00541330) Image Index'\r\n}, {\r\n    id: 'x00280004',\r\n    text: '(x00280004) Photometric Interpretation'\r\n}, {\r\n    id: 'x00180050',\r\n    text: '(x00180050) Slice Thickness'\r\n}];\r\n","function getDefaultProtocol() {\r\n    var protocol = new HP.Protocol('Default');\r\n    protocol.id = 'defaultProtocol';\r\n    protocol.locked = true;\r\n\r\n    var oneByOne = new HP.ViewportStructure('grid', {\r\n        rows: 1,\r\n        columns: 1\r\n    });\r\n\r\n    var viewport = new HP.Viewport();\r\n    var first = new HP.Stage(oneByOne, 'oneByOne');\r\n    first.viewports.push(viewport);\r\n\r\n    protocol.stages.push(first);\r\n\r\n    HP.defaultProtocol = protocol;\r\n    return HP.defaultProtocol;\r\n}\r\n\r\nfunction getMRTwoByTwoTest() {\r\n    var proto = new HP.Protocol('MR_TwoByTwo');\r\n    proto.id = 'MR_TwoByTwo';\r\n    proto.locked = true;\r\n    // Use http://localhost:3000/viewer/1.2.840.113619.2.5.1762583153.215519.978957063.78\r\n\r\n    var studyInstanceUid = new HP.ProtocolMatchingRule('studyInstanceUid', {\r\n        equals: {\r\n            value: '1.2.840.113619.2.5.1762583153.215519.978957063.78'\r\n        }\r\n    }, true);\r\n\r\n    proto.addProtocolMatchingRule(studyInstanceUid);\r\n\r\n    var oneByTwo = new HP.ViewportStructure('grid', {\r\n        rows: 1,\r\n        columns: 2\r\n    });\r\n\r\n    // Stage 1\r\n    var left = new HP.Viewport();\r\n    var right = new HP.Viewport();\r\n\r\n    var firstSeries = new HP.SeriesMatchingRule('seriesNumber', {\r\n        equals: {\r\n            value: 1\r\n        }\r\n    });\r\n\r\n    var secondSeries = new HP.SeriesMatchingRule('seriesNumber', {\r\n        equals: {\r\n            value: 2\r\n        }\r\n    });\r\n\r\n    var thirdImage = new HP.ImageMatchingRule('instanceNumber', {\r\n        equals: {\r\n            value: 3\r\n        }\r\n    });\r\n\r\n    left.seriesMatchingRules.push(firstSeries);\r\n    left.imageMatchingRules.push(thirdImage);\r\n\r\n    right.seriesMatchingRules.push(secondSeries);\r\n    right.imageMatchingRules.push(thirdImage);\r\n\r\n    var first = new HP.Stage(oneByTwo, 'oneByTwo');\r\n    first.viewports.push(left);\r\n    first.viewports.push(right);\r\n\r\n    proto.stages.push(first);\r\n\r\n    // Stage 2\r\n    var twoByOne = new HP.ViewportStructure('grid', {\r\n        rows: 2,\r\n        columns: 1\r\n    });\r\n    var left2 = new HP.Viewport();\r\n    var right2 = new HP.Viewport();\r\n\r\n    var fourthSeries = new HP.SeriesMatchingRule('seriesNumber', {\r\n        equals: {\r\n            value: 4\r\n        }\r\n    });\r\n\r\n    var fifthSeries = new HP.SeriesMatchingRule('seriesNumber', {\r\n        equals: {\r\n            value: 5\r\n        }\r\n    });\r\n\r\n    left2.seriesMatchingRules.push(fourthSeries);\r\n    left2.imageMatchingRules.push(thirdImage);\r\n    right2.seriesMatchingRules.push(fifthSeries);\r\n    right2.imageMatchingRules.push(thirdImage);\r\n\r\n    var second = new HP.Stage(twoByOne, 'twoByOne');\r\n    second.viewports.push(left2);\r\n    second.viewports.push(right2);\r\n\r\n    proto.stages.push(second);\r\n\r\n    HP.testProtocol = proto;\r\n    return HP.testProtocol;\r\n}\r\n\r\nfunction getDemoProtocols() {\r\n\r\n    HP.demoProtocols = [];\r\n\r\n    /**\r\n     * Demo #1\r\n     */\r\n    HP.demoProtocols.push({\r\n        \"id\": \"demoProtocol1\",\r\n        \"locked\": false,\r\n        \"name\": \"DFCI-CT-CHEST-COMPARE\",\r\n        \"createdDate\": \"2017-02-14T16:07:09.033Z\",\r\n        \"modifiedDate\": \"2017-02-14T16:18:43.930Z\",\r\n        \"availableTo\": {},\r\n        \"editableBy\": {},\r\n        \"protocolMatchingRules\": [\r\n            {\r\n                \"id\": \"7tmuq7KzDMCWFeapc\",\r\n                \"weight\": 2,\r\n                \"required\": false,\r\n                \"attribute\": \"x00081030\",\r\n                \"constraint\": {\r\n                    \"contains\": {\r\n                        \"value\": \"DFCI CT CHEST\"\r\n                    }\r\n                }\r\n            }\r\n        ],\r\n        \"stages\": [\r\n            {\r\n                \"id\": \"v5PfGt9F6mffZPif5\",\r\n                \"name\": \"oneByOne\",\r\n                \"viewportStructure\": {\r\n                    \"type\": \"grid\",\r\n                    \"properties\": {\r\n                        \"rows\": 1,\r\n                        \"columns\": 2\r\n                    },\r\n                    \"layoutTemplateName\": \"gridLayout\"\r\n                },\r\n                \"viewports\": [\r\n                    {\r\n                        \"viewportSettings\": {},\r\n                        \"imageMatchingRules\": [],\r\n                        \"seriesMatchingRules\": [\r\n                            {\r\n                                \"id\": \"mXnsCcNzZL56z7mTZ\",\r\n                                \"weight\": 1,\r\n                                \"required\": false,\r\n                                \"attribute\": \"x0008103e\",\r\n                                \"constraint\": {\r\n                                    \"contains\": {\r\n                                        \"value\": \"2.0\"\r\n                                    }\r\n                                }\r\n                            }\r\n                        ],\r\n                        \"studyMatchingRules\": []\r\n                    },\r\n                    {\r\n                        \"viewportSettings\": {},\r\n                        \"imageMatchingRules\": [],\r\n                        \"seriesMatchingRules\": [\r\n                            {\r\n                                \"id\": \"ygz4nb28iJZcJhnYa\",\r\n                                \"weight\": 1,\r\n                                \"required\": false,\r\n                                \"attribute\": \"x0008103e\",\r\n                                \"constraint\": {\r\n                                    \"contains\": {\r\n                                        \"value\": \"2.0\"\r\n                                    }\r\n                                }\r\n                            }\r\n                        ],\r\n                        \"studyMatchingRules\": [\r\n                            {\r\n                                \"id\": \"uDoEgLTvnXTByWnPz\",\r\n                                \"weight\": 1,\r\n                                \"required\": false,\r\n                                \"attribute\": \"abstractPriorValue\",\r\n                                \"constraint\": {\r\n                                    \"equals\": {\r\n                                        \"value\": 1\r\n                                    }\r\n                                }\r\n                            }\r\n                        ]\r\n                    }\r\n                ],\r\n                \"createdDate\": \"2017-02-14T16:07:09.033Z\"\r\n            },\r\n            {\r\n                \"id\": \"XTzu8HB3feep3HYKs\",\r\n                \"viewportStructure\": {\r\n                    \"type\": \"grid\",\r\n                    \"properties\": {\r\n                        \"rows\": 1,\r\n                        \"columns\": 2\r\n                    },\r\n                    \"layoutTemplateName\": \"gridLayout\"\r\n                },\r\n                \"viewports\": [\r\n                    {\r\n                        \"viewportSettings\": {},\r\n                        \"imageMatchingRules\": [],\r\n                        \"seriesMatchingRules\": [\r\n                            {\r\n                                \"id\": \"mXnsCcNzZL56z7mTZ\",\r\n                                \"weight\": 1,\r\n                                \"required\": false,\r\n                                \"attribute\": \"x0008103e\",\r\n                                \"constraint\": {\r\n                                    \"contains\": {\r\n                                        \"value\": \"3.0\"\r\n                                    }\r\n                                }\r\n                            }\r\n                        ],\r\n                        \"studyMatchingRules\": []\r\n                    },\r\n                    {\r\n                        \"viewportSettings\": {},\r\n                        \"imageMatchingRules\": [],\r\n                        \"seriesMatchingRules\": [\r\n                            {\r\n                                \"id\": \"ygz4nb28iJZcJhnYa\",\r\n                                \"weight\": 1,\r\n                                \"required\": false,\r\n                                \"attribute\": \"x0008103e\",\r\n                                \"constraint\": {\r\n                                    \"contains\": {\r\n                                        \"value\": \"3.0\"\r\n                                    }\r\n                                }\r\n                            }\r\n                        ],\r\n                        \"studyMatchingRules\": [\r\n                            {\r\n                                \"id\": \"uDoEgLTvnXTByWnPz\",\r\n                                \"weight\": 1,\r\n                                \"required\": false,\r\n                                \"attribute\": \"abstractPriorValue\",\r\n                                \"constraint\": {\r\n                                    \"equals\": {\r\n                                        \"value\": 1\r\n                                    }\r\n                                }\r\n                            }\r\n                        ]\r\n                    }\r\n                ],\r\n                \"createdDate\": \"2017-02-14T16:07:12.085Z\"\r\n            },\r\n            {\r\n                \"id\": \"3yPYNaeFtr76Qz3jq\",\r\n                \"viewportStructure\": {\r\n                    \"type\": \"grid\",\r\n                    \"properties\": {\r\n                        \"rows\": 2,\r\n                        \"columns\": 2\r\n                    },\r\n                    \"layoutTemplateName\": \"gridLayout\"\r\n                },\r\n                \"viewports\": [\r\n                    {\r\n                        \"viewportSettings\": {},\r\n                        \"imageMatchingRules\": [],\r\n                        \"seriesMatchingRules\": [\r\n                            {\r\n                                \"id\": \"mXnsCcNzZL56z7mTZ\",\r\n                                \"weight\": 1,\r\n                                \"required\": false,\r\n                                \"attribute\": \"x0008103e\",\r\n                                \"constraint\": {\r\n                                    \"contains\": {\r\n                                        \"value\": \"Body 3.0\"\r\n                                    }\r\n                                }\r\n                            }\r\n                        ],\r\n                        \"studyMatchingRules\": []\r\n                    },\r\n                    {\r\n                        \"viewportSettings\": {\r\n                            \"wlPreset\": \"Lung\"\r\n                        },\r\n                        \"imageMatchingRules\": [],\r\n                        \"seriesMatchingRules\": [\r\n                            {\r\n                                \"id\": \"ygz4nb28iJZcJhnYa\",\r\n                                \"weight\": 1,\r\n                                \"required\": false,\r\n                                \"attribute\": \"x0008103e\",\r\n                                \"constraint\": {\r\n                                    \"contains\": {\r\n                                        \"value\": \"Lung 3.0\"\r\n                                    }\r\n                                }\r\n                            }\r\n                        ],\r\n                        \"studyMatchingRules\": []\r\n                    },\r\n                    {\r\n                        \"viewportSettings\": {},\r\n                        \"imageMatchingRules\": [],\r\n                        \"seriesMatchingRules\": [\r\n                            {\r\n                                \"id\": \"6vdBRZYnqmmosipph\",\r\n                                \"weight\": 1,\r\n                                \"required\": false,\r\n                                \"attribute\": \"x0008103e\",\r\n                                \"constraint\": {\r\n                                    \"contains\": {\r\n                                        \"value\": \"Body 3.0\"\r\n                                    }\r\n                                }\r\n                            }\r\n                        ],\r\n                        \"studyMatchingRules\": [\r\n                            {\r\n                                \"id\": \"SxfTyhGcMhr56PtPM\",\r\n                                \"weight\": 1,\r\n                                \"required\": false,\r\n                                \"attribute\": \"abstractPriorValue\",\r\n                                \"constraint\": {\r\n                                    \"equals\": {\r\n                                        \"value\": 1\r\n                                    }\r\n                                }\r\n                            }\r\n                        ]\r\n                    },\r\n                    {\r\n                        \"viewportSettings\": {\r\n                            \"wlPreset\": \"Lung\"\r\n                        },\r\n                        \"imageMatchingRules\": [],\r\n                        \"seriesMatchingRules\": [\r\n                            {\r\n                                \"id\": \"FTAyChZCPW68yJjXD\",\r\n                                \"weight\": 1,\r\n                                \"required\": false,\r\n                                \"attribute\": \"x0008103e\",\r\n                                \"constraint\": {\r\n                                    \"contains\": {\r\n                                        \"value\": \"Lung 3.0\"\r\n                                    }\r\n                                }\r\n                            }\r\n                        ],\r\n                        \"studyMatchingRules\": [\r\n                            {\r\n                                \"id\": \"gMJjfrbsqYNbErPx5\",\r\n                                \"weight\": 1,\r\n                                \"required\": false,\r\n                                \"attribute\": \"abstractPriorValue\",\r\n                                \"constraint\": {\r\n                                    \"equals\": {\r\n                                        \"value\": 1\r\n                                    }\r\n                                }\r\n                            }\r\n                        ]\r\n                    }\r\n                ],\r\n                \"createdDate\": \"2017-02-14T16:11:40.489Z\"\r\n            }\r\n        ],\r\n        \"numberOfPriorsReferenced\": 4\r\n    });\r\n\r\n    /**\r\n     * Demo #2\r\n     */\r\n\r\n    HP.demoProtocols.push({\r\n        \"id\": \"demoProtocol2\",\r\n        \"locked\": false,\r\n        \"name\": \"DFCI-CT-CHEST-COMPARE-2\",\r\n        \"createdDate\": \"2017-02-14T16:07:09.033Z\",\r\n        \"modifiedDate\": \"2017-02-14T16:18:43.930Z\",\r\n        \"availableTo\": {},\r\n        \"editableBy\": {},\r\n        \"protocolMatchingRules\": [{\r\n            \"id\": \"7tmuq7KzDMCWFeapc\",\r\n            \"weight\": 2,\r\n            \"required\": false,\r\n            \"attribute\": \"x00081030\",\r\n            \"constraint\": {\r\n                \"contains\": {\r\n                    \"value\": \"DFCI CT CHEST\"\r\n                }\r\n            }\r\n        }],\r\n        \"stages\": [{\r\n            \"id\": \"v5PfGt9F6mffZPif5\",\r\n            \"name\": \"oneByOne\",\r\n            \"viewportStructure\": {\r\n                \"type\": \"grid\",\r\n                \"properties\": {\r\n                    \"rows\": 1,\r\n                    \"columns\": 2\r\n                },\r\n                \"layoutTemplateName\": \"gridLayout\"\r\n            },\r\n            \"viewports\": [{\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXnsCcNzZL56z7mac\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"2.0\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": []\r\n            }, {\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"ygz4nb28iJZcJhnYc\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"2.0\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": [{\r\n                    \"id\": \"uDoEgLTvnXTByWnPt\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"abstractPriorValue\",\r\n                    \"constraint\": {\r\n                        \"equals\": {\r\n                            \"value\": 1\r\n                        }\r\n                    }\r\n                }]\r\n            }],\r\n            \"createdDate\": \"2017-02-14T16:07:09.033Z\"\r\n        }, {\r\n            \"id\": \"XTzu8HB3feep3HYKs\",\r\n            \"viewportStructure\": {\r\n                \"type\": \"grid\",\r\n                \"properties\": {\r\n                    \"rows\": 1,\r\n                    \"columns\": 2\r\n                },\r\n                \"layoutTemplateName\": \"gridLayout\"\r\n            },\r\n            \"viewports\": [{\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXnsCcNzZL56z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Body 3.0\"\r\n                        }\r\n                    }\r\n                }, {\r\n                    \"id\": \"mYnsCcNwZL56z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Body 5.0\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": []\r\n            }, {\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"ygz4nb28iJZcJhnYa\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Body 3.0\"\r\n                        }\r\n                    }\r\n                }, {\r\n                    \"id\": \"ygz4nb29iJZcJhnYa\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Body 5.0\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": [{\r\n                    \"id\": \"uDoEgLTvnXTByWnPz\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"abstractPriorValue\",\r\n                    \"constraint\": {\r\n                        \"equals\": {\r\n                            \"value\": 1\r\n                        }\r\n                    }\r\n                }]\r\n            }],\r\n            \"createdDate\": \"2017-02-14T16:07:12.085Z\"\r\n        }, {\r\n            \"id\": \"3yPYNaeFtr76Qz3jq\",\r\n            \"viewportStructure\": {\r\n                \"type\": \"grid\",\r\n                \"properties\": {\r\n                    \"rows\": 2,\r\n                    \"columns\": 2\r\n                },\r\n                \"layoutTemplateName\": \"gridLayout\"\r\n            },\r\n            \"viewports\": [{\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXnsCcNzZL56z7mtr\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Body 3.0\"\r\n                        }\r\n                    }\r\n                }, {\r\n                    \"id\": \"jXnsCcNzZL56z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Body 5.0\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": []\r\n            }, {\r\n                \"viewportSettings\": {\r\n                    \"wlPreset\": \"Lung\"\r\n                },\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"ygz4nb28iJZcJhnYb\",\r\n                    \"weight\": 2,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Lung 3.0\"\r\n                        }\r\n                    }\r\n                }, {\r\n                    \"id\": \"ycz4nb28iJZcJhnYa\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Lung 5.0\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": []\r\n            }, {\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"6vdBRZYnqmmosipph\",\r\n                    \"weight\": 2,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Body 3.0\"\r\n                        }\r\n                    }\r\n                }, {\r\n                    \"id\": \"6vdBRFYnqmmosipph\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Body 5.0\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": [{\r\n                    \"id\": \"SxfTyhGcMhr56PtPM\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"abstractPriorValue\",\r\n                    \"constraint\": {\r\n                        \"equals\": {\r\n                            \"value\": 1\r\n                        }\r\n                    }\r\n                }]\r\n            }, {\r\n                \"viewportSettings\": {\r\n                    \"wlPreset\": \"Lung\"\r\n                },\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"FTAyChZCPW68yJjXD\",\r\n                    \"weight\": 2,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Lung 3.0\"\r\n                        }\r\n                    }\r\n                }, {\r\n                    \"id\": \"DTAyChZCPW68yJjXD\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Lung 5.0\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": [{\r\n                    \"id\": \"gMJjfrbsqYNbErPx5\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"abstractPriorValue\",\r\n                    \"constraint\": {\r\n                        \"equals\": {\r\n                            \"value\": 1\r\n                        }\r\n                    }\r\n                }]\r\n            }],\r\n            \"createdDate\": \"2017-02-14T16:11:40.489Z\"\r\n        }],\r\n        \"numberOfPriorsReferenced\": 1\r\n    });\r\n\r\n    /**\r\n     * Demo: screenCT\r\n     */\r\n\r\n    HP.demoProtocols.push({\r\n        \"id\": \"screenCT\",\r\n        \"locked\": false,\r\n        \"name\": \"DFCI-CT-CHEST-SCREEN\",\r\n        \"createdDate\": \"2017-02-14T16:07:09.033Z\",\r\n        \"modifiedDate\": \"2017-02-14T16:18:43.930Z\",\r\n        \"availableTo\": {},\r\n        \"editableBy\": {},\r\n        \"protocolMatchingRules\": [{\r\n            \"id\": \"7tmuq7KzDMCWFeapc\",\r\n            \"weight\": 2,\r\n            \"required\": false,\r\n            \"attribute\": \"x00081030\",\r\n            \"constraint\": {\r\n                \"contains\": {\r\n                    \"value\": \"DFCI CT CHEST\"\r\n                }\r\n            }\r\n        }],\r\n        \"stages\": [{\r\n            \"id\": \"v5PfGt9F6mffZPif5\",\r\n            \"name\": \"oneByOne\",\r\n            \"viewportStructure\": {\r\n                \"type\": \"grid\",\r\n                \"properties\": {\r\n                    \"rows\": 1,\r\n                    \"columns\": 1\r\n                },\r\n                \"layoutTemplateName\": \"gridLayout\"\r\n            },\r\n            \"viewports\": [{\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXnsCcNzZL55z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"2.0\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": []\r\n            }],\r\n            \"createdDate\": \"2017-02-14T16:07:09.033Z\"\r\n        },\r\n        {\r\n            \"id\": \"v5PfGt9F4mffZPif5\",\r\n            \"name\": \"oneByOne\",\r\n            \"viewportStructure\": {\r\n                \"type\": \"grid\",\r\n                \"properties\": {\r\n                    \"rows\": 2,\r\n                    \"columns\": 2\r\n                },\r\n                \"layoutTemplateName\": \"gridLayout\"\r\n            },\r\n            \"viewports\": [{\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXnsCcNzZL56z7nTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Body 5.0\"\r\n                        }\r\n                    }\r\n                }, {\r\n                    \"id\": \"mXnsCcNzZL56z7rTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Body 3.0\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": []\r\n            }, {\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXnsCcNzZL56r7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Lung 5.0\"\r\n                        }\r\n                    }\r\n                }, {\r\n                    \"id\": \"mXnsCcNzZL56a7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Lung 3.0\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": []\r\n            }, {\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXnsCcRzZL56z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Body 4.0\"\r\n                        }\r\n                    }\r\n                }, {\r\n                    \"id\": \"mXnsCcNzTL56z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Coronal\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": []\r\n            }, {\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXnsCcMzZL56z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Body 4.0\"\r\n                        }\r\n                    }\r\n                }, {\r\n                    \"id\": \"mXnsCcAzZL56z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Sagittal\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": []\r\n            }],\r\n            \"createdDate\": \"2017-02-14T16:07:09.033Z\"\r\n        }],\r\n        \"numberOfPriorsReferenced\": 0\r\n    });\r\n\r\n    /**\r\n     * Demo: PETCTSCREEN\r\n     */\r\n\r\n    HP.demoProtocols.push({\r\n        \"id\": \"PETCTSCREEN\",\r\n        \"locked\": false,\r\n        \"name\": \"PETCT-SCREEN\",\r\n        \"createdDate\": \"2017-02-14T16:07:09.033Z\",\r\n        \"modifiedDate\": \"2017-02-14T16:18:43.930Z\",\r\n        \"availableTo\": {},\r\n        \"editableBy\": {},\r\n        \"protocolMatchingRules\": [{\r\n            \"id\": \"7tmuqgKzDMCWFeapc\",\r\n            \"weight\": 5,\r\n            \"required\": false,\r\n            \"attribute\": \"x00081030\",\r\n            \"constraint\": {\r\n                \"contains\": {\r\n                    \"value\": \"PETCT\"\r\n                }\r\n            }\r\n        }],\r\n        \"stages\": [{\r\n            \"id\": \"v5PfGt9F6mFgZPif5\",\r\n            \"name\": \"oneByOne\",\r\n            \"viewportStructure\": {\r\n                \"type\": \"grid\",\r\n                \"properties\": {\r\n                    \"rows\": 1,\r\n                    \"columns\": 2\r\n                },\r\n                \"layoutTemplateName\": \"gridLayout\"\r\n            },\r\n            \"viewports\": [{\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXnsCcAzZL56z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Topogram\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": []\r\n            }, {\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXnsCcNzZR56z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Topogram\"\r\n                        }\r\n                    }\r\n                }, {\r\n                    \"id\": \"mRnsCcNzZL56z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x00200011\",\r\n                    \"constraint\": {\r\n                        \"numericality\": {\r\n                            \"greaterThanOrEqualTo\": 2\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": []\r\n            }],\r\n            \"createdDate\": \"2017-02-14T16:07:09.033Z\"\r\n        }, {\r\n            \"id\": \"v5PfGt9F6mFgZPif5\",\r\n            \"name\": \"oneByOne\",\r\n            \"viewportStructure\": {\r\n                \"type\": \"grid\",\r\n                \"properties\": {\r\n                    \"rows\": 1,\r\n                    \"columns\": 2\r\n                },\r\n                \"layoutTemplateName\": \"gridLayout\"\r\n            },\r\n            \"viewports\": [{\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXnsGcNzZL56z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"PET WB Corrected\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": []\r\n            }, {\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXnsHcNzZL56z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"CT WB\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": []\r\n            }],\r\n            \"createdDate\": \"2017-02-14T16:07:09.033Z\"\r\n        }, {\r\n            \"id\": \"v5PfGt9F6mFgZPif5\",\r\n            \"name\": \"oneByOne\",\r\n            \"viewportStructure\": {\r\n                \"type\": \"grid\",\r\n                \"properties\": {\r\n                    \"rows\": 1,\r\n                    \"columns\": 2\r\n                },\r\n                \"layoutTemplateName\": \"gridLayout\"\r\n            },\r\n            \"viewports\": [{\r\n                \"viewportSettings\": {\r\n                    \"invert\": \"YES\"\r\n                },\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXneCcNzZL56z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"PET WB Uncorrected\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": []\r\n            }, {\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXnsCuNzZL56z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"CT Nk\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": []\r\n            }],\r\n            \"createdDate\": \"2017-02-14T16:07:09.033Z\"\r\n        }],\r\n        \"numberOfPriorsReferenced\": 0\r\n    });\r\n\r\n    /**\r\n     * Demo: PETCTCOMPARE\r\n     */\r\n\r\n    HP.demoProtocols.push({\r\n        \"id\": \"PETCTCOMPARE\",\r\n        \"locked\": false,\r\n        \"name\": \"PETCT-COMPARE\",\r\n        \"createdDate\": \"2017-02-14T16:07:09.033Z\",\r\n        \"modifiedDate\": \"2017-02-14T16:18:43.930Z\",\r\n        \"availableTo\": {},\r\n        \"editableBy\": {},\r\n        \"protocolMatchingRules\": [{\r\n            \"id\": \"7tmuqgKzDMCWFeapc\",\r\n            \"weight\": 5,\r\n            \"required\": false,\r\n            \"attribute\": \"x00081030\",\r\n            \"constraint\": {\r\n                \"contains\": {\r\n                    \"value\": \"PETCT\"\r\n                }\r\n            }\r\n        }],\r\n        \"stages\": [{\r\n            \"id\": \"v5PfGt9F6mFgZPif5\",\r\n            \"name\": \"oneByOne\",\r\n            \"viewportStructure\": {\r\n                \"type\": \"grid\",\r\n                \"properties\": {\r\n                    \"rows\": 1,\r\n                    \"columns\": 2\r\n                },\r\n                \"layoutTemplateName\": \"gridLayout\"\r\n            },\r\n            \"viewports\": [{\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXnsCcNzZL59z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Topogram\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": []\r\n            }, {\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXnsCcNzZL56z7lTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Topogram\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": [{\r\n                    \"id\": \"uDoEgLTbnXTByWnPz\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"abstractPriorValue\",\r\n                    \"constraint\": {\r\n                        \"equals\": {\r\n                            \"value\": 1\r\n                        }\r\n                    }\r\n                }]\r\n            }],\r\n            \"createdDate\": \"2017-02-14T16:07:09.033Z\"\r\n        }, {\r\n            \"id\": \"v5PfGt9F6mFgZPif5\",\r\n            \"name\": \"oneByOne\",\r\n            \"viewportStructure\": {\r\n                \"type\": \"grid\",\r\n                \"properties\": {\r\n                    \"rows\": 1,\r\n                    \"columns\": 2\r\n                },\r\n                \"layoutTemplateName\": \"gridLayout\"\r\n            },\r\n            \"viewports\": [{\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXnsCcNjZL56z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Topogram\"\r\n                        }\r\n                    }\r\n                }, {\r\n                    \"id\": \"mXnsCcNzZL56z7gTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x00200011\",\r\n                    \"constraint\": {\r\n                        \"numericality\": {\r\n                            \"greaterThanOrEqualTo\": 2\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": []\r\n            }, {\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXnsCcCzZL56z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"Topogram\"\r\n                        }\r\n                    }\r\n                }, {\r\n                    \"id\": \"mXnsCcNzZL56z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x00200011\",\r\n                    \"constraint\": {\r\n                        \"numericality\": {\r\n                            \"greaterThanOrEqualTo\": 2\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": [{\r\n                    \"id\": \"uDoEgLTvn1TByWnPz\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"abstractPriorValue\",\r\n                    \"constraint\": {\r\n                        \"equals\": {\r\n                            \"value\": 1\r\n                        }\r\n                    }\r\n                }]\r\n            }],\r\n            \"createdDate\": \"2017-02-14T16:07:09.033Z\"\r\n        }, {\r\n            \"id\": \"v5PfGt9F6mFgZPif5\",\r\n            \"name\": \"oneByOne\",\r\n            \"viewportStructure\": {\r\n                \"type\": \"grid\",\r\n                \"properties\": {\r\n                    \"rows\": 2,\r\n                    \"columns\": 2\r\n                },\r\n                \"layoutTemplateName\": \"gridLayout\"\r\n            },\r\n            \"viewports\": [{\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXnsCcNzZL26z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"PET WB Corrected\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": []\r\n            }, {\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXnsCcNzZL46z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"CT WB\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": []\r\n            }, {\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXnsCcNzZL57z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"PET WB Corrected\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": [{\r\n                    \"id\": \"uDoEgLTvnYTByWnPz\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"abstractPriorValue\",\r\n                    \"constraint\": {\r\n                        \"equals\": {\r\n                            \"value\": 1\r\n                        }\r\n                    }\r\n                }]\r\n            }, {\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXnsCcNzZQ56z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"CT WB\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": [{\r\n                    \"id\": \"uDoEgLTvnKTByWnPz\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"abstractPriorValue\",\r\n                    \"constraint\": {\r\n                        \"equals\": {\r\n                            \"value\": 1\r\n                        }\r\n                    }\r\n                }]\r\n            }],\r\n            \"createdDate\": \"2017-02-14T16:07:09.033Z\"\r\n        }, {\r\n            \"id\": \"v5PfGt9F6mFgZPif5\",\r\n            \"name\": \"oneByOne\",\r\n            \"viewportStructure\": {\r\n                \"type\": \"grid\",\r\n                \"properties\": {\r\n                    \"rows\": 2,\r\n                    \"columns\": 2\r\n                },\r\n                \"layoutTemplateName\": \"gridLayout\"\r\n            },\r\n            \"viewports\": [{\r\n                \"viewportSettings\": {\r\n                    \"invert\": \"YES\"\r\n                },\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXnsCcNzZL56z7nTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"PET WB Uncorrected\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": []\r\n            }, {\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXnsCcNxZL56z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"CT Nk\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": []\r\n            }, {\r\n                \"viewportSettings\": {\r\n                    \"invert\": \"YES\"\r\n                },\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXnsCcNzZA56z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"PET WB Uncorrected\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": [{\r\n                    \"id\": \"uDoEgHTvnXTByWnPz\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"abstractPriorValue\",\r\n                    \"constraint\": {\r\n                        \"equals\": {\r\n                            \"value\": 1\r\n                        }\r\n                    }\r\n                }]\r\n            }, {\r\n                \"viewportSettings\": {},\r\n                \"imageMatchingRules\": [],\r\n                \"seriesMatchingRules\": [{\r\n                    \"id\": \"mXnsCcNzZP56z7mTZ\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"x0008103e\",\r\n                    \"constraint\": {\r\n                        \"contains\": {\r\n                            \"value\": \"CT Nk\"\r\n                        }\r\n                    }\r\n                }],\r\n                \"studyMatchingRules\": [{\r\n                    \"id\": \"uDoEgITvnXTByWnPz\",\r\n                    \"weight\": 1,\r\n                    \"required\": false,\r\n                    \"attribute\": \"abstractPriorValue\",\r\n                    \"constraint\": {\r\n                        \"equals\": {\r\n                            \"value\": 1\r\n                        }\r\n                    }\r\n                }]\r\n            }],\r\n            \"createdDate\": \"2017-02-14T16:07:09.033Z\"\r\n        }],\r\n        \"numberOfPriorsReferenced\": 1\r\n    });\r\n\r\n}\r\n\r\ngetDefaultProtocol();\r\n//getMRTwoByTwoTest();\r\n//getDemoProtocols();\r\n","import { Meteor } from 'meteor/meteor';\r\nimport { Random } from 'meteor/random';\r\nimport { OHIF } from 'meteor/ohif:core';\r\n\r\n// Local imports\r\nimport { removeFromArray } from '../lib/removeFromArray';\r\n\r\n/**\r\n * This class represents a Hanging Protocol at the highest level\r\n *\r\n * @type {Protocol}\r\n */\r\nHP.Protocol = class Protocol {\r\n    /**\r\n     * The Constructor for the Class to create a Protocol with the bare\r\n     * minimum information\r\n     *\r\n     * @param name The desired name for the Protocol\r\n     */\r\n    constructor(name) {\r\n        // Create a new UUID for this Protocol\r\n        this.id = Random.id();\r\n\r\n        // Store a value which determines whether or not a Protocol is locked\r\n        // This is probably temporary, since we will eventually have role / user\r\n        // checks for editing. For now we just need it to prevent changes to the\r\n        // default protocols.\r\n        this.locked = false;\r\n\r\n        // Boolean value to indicate if the protocol has updated priors information\r\n        // it's set in \"updateNumberOfPriorsReferenced\" function\r\n        this.hasUpdatedPriorsInformation = false;\r\n\r\n        // Apply the desired name\r\n        this.name = name;\r\n\r\n        // Set the created and modified dates to Now\r\n        this.createdDate = new Date();\r\n        this.modifiedDate = new Date();\r\n\r\n        // If we are logged in while creating this Protocol,\r\n        // store this information as well\r\n        if (OHIF.user && OHIF.user.userLoggedIn && OHIF.user.userLoggedIn()) {\r\n            this.createdBy = OHIF.user.getUserId();\r\n            this.modifiedBy = OHIF.user.getUserId();\r\n        }\r\n\r\n        // Create two empty Sets specifying which roles\r\n        // have read and write access to this Protocol\r\n        this.availableTo = new Set();\r\n        this.editableBy = new Set();\r\n\r\n        // Define empty arrays for the Protocol matching rules\r\n        // and Stages\r\n        this.protocolMatchingRules = [];\r\n        this.stages = [];\r\n\r\n        // Define auxiliary values for priors\r\n        this.numberOfPriorsReferenced = -1;\r\n    }\r\n\r\n    getNumberOfPriorsReferenced(skipCache = false) {\r\n        let numberOfPriorsReferenced = skipCache !== true ? this.numberOfPriorsReferenced : -1;\r\n\r\n        // Check if information is cached already\r\n        if (numberOfPriorsReferenced > -1) {\r\n            return numberOfPriorsReferenced;\r\n        }\r\n\r\n        numberOfPriorsReferenced = 0;\r\n\r\n        // Search each study matching rule for prior rules\r\n        // Each stage can have many viewports that can have\r\n        // multiple study matching rules.\r\n        this.stages.forEach(stage => {\r\n            if (!stage.viewports) {\r\n                return;\r\n            }\r\n\r\n            stage.viewports.forEach(viewport => {\r\n                if (!viewport.studyMatchingRules) {\r\n                    return;\r\n                }\r\n\r\n                viewport.studyMatchingRules.forEach(rule => {\r\n                    // If the current rule is not a priors rule, it will return -1 then numberOfPriorsReferenced will continue to be 0\r\n                    const priorsReferenced = rule.getNumberOfPriorsReferenced();\r\n                    if (priorsReferenced > numberOfPriorsReferenced) {\r\n                        numberOfPriorsReferenced = priorsReferenced;\r\n                    }\r\n                });\r\n            });\r\n        });\r\n\r\n        this.numberOfPriorsReferenced = numberOfPriorsReferenced;\r\n\r\n        return numberOfPriorsReferenced\r\n    }\r\n\r\n    updateNumberOfPriorsReferenced() {\r\n        this.getNumberOfPriorsReferenced(true);\r\n    }\r\n\r\n    /**\r\n     * Method to update the modifiedDate when the Protocol\r\n     * has been changed\r\n     */\r\n    protocolWasModified() {\r\n        // If we are logged in while modifying this Protocol,\r\n        // store this information as well\r\n        if (OHIF.user && OHIF.user.userLoggedIn && OHIF.user.userLoggedIn()) {\r\n            this.modifiedBy = OHIF.user.getUserId();\r\n        }\r\n\r\n        // Protocol has been modified, so mark priors information\r\n        // as \"outdated\"\r\n        this.hasUpdatedPriorsInformation = false;\r\n\r\n        // Update number of priors referenced info\r\n        this.updateNumberOfPriorsReferenced();\r\n\r\n        // Update the modifiedDate with the current Date/Time\r\n        this.modifiedDate = new Date();\r\n    }\r\n\r\n    /**\r\n     * Occasionally the Protocol class needs to be instantiated from a JavaScript Object\r\n     * containing the Protocol data. This function fills in a Protocol with the Object\r\n     * data.\r\n     *\r\n     * @param input A Protocol as a JavaScript Object, e.g. retrieved from MongoDB or JSON\r\n     */\r\n    fromObject(input) {\r\n        // Check if the input already has an ID\r\n        // If so, keep it. It not, create a new UUID\r\n        this.id = input.id || Random.id();\r\n\r\n        // Assign the input name to the Protocol\r\n        this.name = input.name;\r\n\r\n        // Retrieve locked status, use !! to make it truthy\r\n        // so that undefined values will be set to false\r\n        this.locked = !!input.locked;\r\n\r\n        // TODO: Check how to regenerate Set from Object\r\n        //this.availableTo = new Set(input.availableTo);\r\n        //this.editableBy = new Set(input.editableBy);\r\n\r\n        // If the input contains Protocol matching rules\r\n        if (input.protocolMatchingRules) {\r\n            input.protocolMatchingRules.forEach(ruleObject => {\r\n                // Create new Rules from the stored data\r\n                var rule = new HP.ProtocolMatchingRule();\r\n                rule.fromObject(ruleObject);\r\n\r\n                // Add them to the Protocol\r\n                this.protocolMatchingRules.push(rule);\r\n            });\r\n        }\r\n\r\n        // If the input contains data for various Stages in the\r\n        // display set sequence\r\n        if (input.stages) {\r\n            input.stages.forEach(stageObject => {\r\n                // Create Stages from the stored data\r\n                var stage = new HP.Stage();\r\n                stage.fromObject(stageObject);\r\n\r\n                // Add them to the Protocol\r\n                this.stages.push(stage);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Creates a clone of the current Protocol with a new name\r\n     *\r\n     * @param name\r\n     * @returns {Protocol|*}\r\n     */\r\n    createClone(name) {\r\n        // Create a new JavaScript independent of the current Protocol\r\n        var currentProtocol = Object.assign({}, this);\r\n\r\n        // Create a new Protocol to return\r\n        var clonedProtocol = new HP.Protocol();\r\n\r\n        // Apply the desired properties\r\n        currentProtocol.id = clonedProtocol.id;\r\n        clonedProtocol.fromObject(currentProtocol);\r\n\r\n        // If we have specified a name, assign it\r\n        if (name) {\r\n            clonedProtocol.name = name;\r\n        }\r\n\r\n        // Unlock the clone\r\n        clonedProtocol.locked = false;\r\n\r\n        // Return the cloned Protocol\r\n        return clonedProtocol;\r\n    }\r\n\r\n    /**\r\n     * Adds a Stage to this Protocol's display set sequence\r\n     *\r\n     * @param stage\r\n     */\r\n    addStage(stage) {\r\n        this.stages.push(stage);\r\n\r\n        // Update the modifiedDate and User that last\r\n        // modified this Protocol\r\n        this.protocolWasModified();\r\n    }\r\n\r\n    /**\r\n     * Adds a Rule to this Protocol's array of matching rules\r\n     *\r\n     * @param rule\r\n     */\r\n    addProtocolMatchingRule(rule) {\r\n        this.protocolMatchingRules.push(rule);\r\n\r\n        // Update the modifiedDate and User that last\r\n        // modified this Protocol\r\n        this.protocolWasModified();\r\n    }\r\n\r\n    /**\r\n     * Removes a Rule from this Protocol's array of matching rules\r\n     *\r\n     * @param rule\r\n     */\r\n    removeProtocolMatchingRule(rule) {\r\n        var wasRemoved = removeFromArray(this.protocolMatchingRules, rule);\r\n\r\n        // Update the modifiedDate and User that last\r\n        // modified this Protocol\r\n        if (wasRemoved) {\r\n            this.protocolWasModified();\r\n        }\r\n    }\r\n};\r\n","import { Random } from 'meteor/random';\r\n\r\nimport { comparators } from '../lib/comparators';\r\n\r\nconst EQUALS_REGEXP = /^equals$/;\r\n\r\n/**\r\n * This Class represents a Rule to be evaluated given a set of attributes\r\n * Rules have:\r\n * - An attribute (e.g. 'seriesDescription')\r\n * - A constraint Object, in the form required by Validate.js:\r\n *\r\n * rule.constraint = {\r\n *   contains: {\r\n *      value: 'T-1'\r\n *      }\r\n *   };\r\n *\r\n *  Note: In this example we use the 'contains' Validator, which is a custom Validator defined in Viewerbase\r\n *\r\n * - A value for whether or not they are Required to be matched (default: False)\r\n * - A value for their relative weighting during Protocol or Image matching (default: 1)\r\n */\r\nexport class Rule {\r\n    /**\r\n     * The Constructor for the Class to create a Rule with the bare\r\n     * minimum information\r\n     *\r\n     * @param name The desired name for the Rule\r\n     */\r\n    constructor(attribute, constraint, required, weight) {\r\n        // Create a new UUID for this Rule\r\n        this.id = Random.id();\r\n\r\n        // Set the Rule's weight (defaults to 1)\r\n        this.weight = weight || 1;\r\n\r\n        // If an attribute is specified, assign it\r\n        if (attribute) {\r\n            this.attribute = attribute;\r\n        }\r\n\r\n        // If a constraint is specified, assign it\r\n        if (constraint) {\r\n            this.constraint = constraint;\r\n        }\r\n\r\n        // If a value for 'required' is specified, assign it\r\n        if (required === undefined) {\r\n            // If no value was specified, default to False\r\n            this.required = false;\r\n        } else {\r\n            this.required = required;\r\n        }\r\n\r\n        // Cache for constraint info object\r\n        this._constraintInfo = void 0;\r\n\r\n        // Cache for validator and value object\r\n        this._validatorAndValue = void 0;\r\n    }\r\n\r\n    /**\r\n     * Occasionally the Rule class needs to be instantiated from a JavaScript Object.\r\n     * This function fills in a Protocol with the Object data.\r\n     *\r\n     * @param input A Rule as a JavaScript Object, e.g. retrieved from MongoDB or JSON\r\n     */\r\n    fromObject(input) {\r\n        // Check if the input already has an ID\r\n        // If so, keep it. It not, create a new UUID\r\n        this.id = input.id || Random.id();\r\n\r\n        // Assign the specified input data to the Rule\r\n        this.required = input.required;\r\n        this.weight = input.weight;\r\n        this.attribute = input.attribute;\r\n        this.constraint = input.constraint;\r\n    }\r\n\r\n    /**\r\n     * Get the constraint info object for the current constraint\r\n     * @return {Object\\undefined} Constraint object or undefined if current constraint \r\n     *                            is not valid or not found in comparators list\r\n     */\r\n    getConstraintInfo() {\r\n        let constraintInfo = this._constraintInfo;\r\n        // Check if info is cached already\r\n        if (constraintInfo !== void 0) {\r\n            return constraintInfo;\r\n        }\r\n\r\n        const ruleConstraint = Object.keys(this.constraint)[0];\r\n\r\n        if (ruleConstraint !== void 0) {\r\n            constraintInfo = comparators.find(comparator => ruleConstraint === comparator.id)\r\n        }\r\n\r\n        // Cache this information for later use\r\n        this._constraintInfo = constraintInfo;\r\n\r\n        return constraintInfo;\r\n    }\r\n\r\n     /**\r\n     * Check if current rule is related to priors\r\n     * @return {Boolean} True if a rule is related to priors or false otherwise\r\n     */\r\n    isRuleForPrior() {\r\n        // @TODO: Should we check this too? this.attribute === 'relativeTime'\r\n        return this.attribute === 'abstractPriorValue';\r\n    }\r\n\r\n    /**\r\n     * If the current rule is a rule for priors, returns the number of referenced priors. Otherwise, returns -1.\r\n     * @return {Number} The number of referenced priors or -1 if not applicable. Returns zero if the actual value could not be determined.\r\n     */\r\n    getNumberOfPriorsReferenced() {\r\n        if (!this.isRuleForPrior()) {\r\n            return -1;\r\n        }\r\n\r\n        // Get rule's validator and value\r\n        const ruleValidatorAndValue = this.getConstraintValidatorAndValue();\r\n        const { value, validator } = ruleValidatorAndValue;\r\n        const intValue = parseInt(value, 10) || 0; // avoid possible NaN\r\n\r\n        // \"Equal to\" validators\r\n        if (EQUALS_REGEXP.test(validator)) {\r\n            // In this case, -1 (the oldest prior) indicates that at least one study is used\r\n            return intValue < 0 ? 1 : intValue;\r\n        }\r\n\r\n        // Default cases return value\r\n        return 0;\r\n    }\r\n\r\n    /**\r\n     * Get the constraint validator and value\r\n     * @return {Object|undefined} Returns an object containing the validator and it's value or undefined\r\n     */\r\n    getConstraintValidatorAndValue() {\r\n        let validatorAndValue = this._validatorAndValue;\r\n        \r\n        // Check if validator and value are cached already\r\n        if (validatorAndValue !== void 0) {\r\n            return validatorAndValue;\r\n        }\r\n\r\n        // Get the constraint info object\r\n        const constraintInfo = this.getConstraintInfo();\r\n\r\n        // Constraint info object exists and is valid\r\n        if (constraintInfo !== void 0) {\r\n            const validator = constraintInfo.validator;\r\n            const currentValidator = this.constraint[validator];\r\n\r\n            if (currentValidator) {\r\n                const constraintValidator = constraintInfo.validatorOption;\r\n                const constraintValue = currentValidator[constraintValidator];\r\n\r\n                validatorAndValue = {\r\n                    value: constraintValue,\r\n                    validator: constraintInfo.id\r\n                };\r\n\r\n                this._validatorAndValue = validatorAndValue;\r\n            }\r\n        }\r\n\r\n        return validatorAndValue;\r\n    }\r\n}\r\n","import { Random } from 'meteor/random';\r\n\r\n/**\r\n * A Stage is one step in the Display Set Sequence for a Hanging Protocol\r\n *\r\n * Stages are defined as a ViewportStructure and an array of Viewports\r\n *\r\n * @type {Stage}\r\n */\r\nHP.Stage = class Stage {\r\n    constructor(ViewportStructure, name) {\r\n        // Create a new UUID for this Stage\r\n        this.id = Random.id();\r\n\r\n        // Assign the name and ViewportStructure provided\r\n        this.name = name;\r\n        this.viewportStructure = ViewportStructure;\r\n\r\n        // Create an empty array for the Viewports\r\n        this.viewports = [];\r\n\r\n        // Set the created date to Now\r\n        this.createdDate = new Date();\r\n    }\r\n\r\n    /**\r\n     * Creates a clone of the current Stage with a new name\r\n     *\r\n     * Note! This method absolutely cannot be renamed 'clone', because\r\n     * Minimongo's insert method uses 'clone' internally and this\r\n     * somehow causes very bizarre behaviour\r\n     *\r\n     * @param name\r\n     * @returns {Stage|*}\r\n     */\r\n    createClone(name) {\r\n        // Create a new JavaScript independent of the current Protocol\r\n        var currentStage = Object.assign({}, this);\r\n\r\n        // Create a new Stage to return\r\n        var clonedStage = new HP.Stage();\r\n\r\n        // Assign the desired properties\r\n        currentStage.id = clonedStage.id;\r\n        clonedStage.fromObject(currentStage);\r\n\r\n        // If we have specified a name, assign it\r\n        if (name) {\r\n            clonedStage.name = name;\r\n        }\r\n\r\n        // Return the cloned Stage\r\n        return clonedStage;\r\n    }\r\n\r\n    /**\r\n     * Occasionally the Stage class needs to be instantiated from a JavaScript Object.\r\n     * This function fills in a Protocol with the Object data.\r\n     *\r\n     * @param input A Stage as a JavaScript Object, e.g. retrieved from MongoDB or JSON\r\n     */\r\n    fromObject(input) {\r\n        // Check if the input already has an ID\r\n        // If so, keep it. It not, create a new UUID\r\n        this.id = input.id || Random.id();\r\n\r\n        // Assign the input name to the Stage\r\n        this.name = input.name;\r\n\r\n        // If a ViewportStructure is present in the input, add it from the\r\n        // input data\r\n        this.viewportStructure = new HP.ViewportStructure();\r\n        this.viewportStructure.fromObject(input.viewportStructure);\r\n\r\n        // If any viewports are present in the input object\r\n        if (input.viewports) {\r\n            input.viewports.forEach(viewportObject => {\r\n                // Create a new Viewport with their data\r\n                var viewport = new HP.Viewport();\r\n                viewport.fromObject(viewportObject);\r\n\r\n                // Add it to the viewports array\r\n                this.viewports.push(viewport);\r\n            });\r\n        }\r\n    }\r\n};","// Local imports\r\nimport { removeFromArray } from '../lib/removeFromArray';\r\n\r\n/**\r\n * This Class defines a Viewport in the Hanging Protocol Stage. A Viewport contains\r\n * arrays of Rules that are matched in the ProtocolEngine in order to determine which\r\n * images should be hung.\r\n *\r\n * @type {Viewport}\r\n */\r\nHP.Viewport = class Viewport {\r\n    constructor() {\r\n        this.viewportSettings = {};\r\n        this.imageMatchingRules = [];\r\n        this.seriesMatchingRules = [];\r\n        this.studyMatchingRules = [];\r\n    }\r\n\r\n    /**\r\n     * Occasionally the Viewport class needs to be instantiated from a JavaScript Object.\r\n     * This function fills in a Viewport with the Object data.\r\n     *\r\n     * @param input The Viewport as a JavaScript Object, e.g. retrieved from MongoDB or JSON\r\n     */\r\n    fromObject(input) {\r\n        // If ImageMatchingRules exist, create them from the Object data\r\n        // and add them to the Viewport's imageMatchingRules array\r\n        if (input.imageMatchingRules) {\r\n            input.imageMatchingRules.forEach(ruleObject => {\r\n                var rule = new HP.ImageMatchingRule();\r\n                rule.fromObject(ruleObject);\r\n                this.imageMatchingRules.push(rule);\r\n            });\r\n        }\r\n\r\n        // If SeriesMatchingRules exist, create them from the Object data\r\n        // and add them to the Viewport's seriesMatchingRules array\r\n        if (input.seriesMatchingRules) {\r\n            input.seriesMatchingRules.forEach(ruleObject => {\r\n                var rule = new HP.SeriesMatchingRule();\r\n                rule.fromObject(ruleObject);\r\n                this.seriesMatchingRules.push(rule);\r\n            });\r\n        }\r\n\r\n        // If StudyMatchingRules exist, create them from the Object data\r\n        // and add them to the Viewport's studyMatchingRules array\r\n        if (input.studyMatchingRules) {\r\n            input.studyMatchingRules.forEach(ruleObject => {\r\n                var rule = new HP.StudyMatchingRule();\r\n                rule.fromObject(ruleObject);\r\n                this.studyMatchingRules.push(rule);\r\n            });\r\n        }\r\n\r\n        // If ViewportSettings exist, add them to the current protocol\r\n        if (input.viewportSettings) {\r\n            this.viewportSettings = input.viewportSettings;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Finds and removes a rule from whichever array it exists in.\r\n     * It is not required to specify if it exists in studyMatchingRules,\r\n     * seriesMatchingRules, or imageMatchingRules\r\n     *\r\n     * @param rule\r\n     */\r\n    removeRule(rule) {\r\n        var array;\r\n        if (rule instanceof HP.StudyMatchingRule) {\r\n            array = this.studyMatchingRules;\r\n        } else if (rule instanceof HP.SeriesMatchingRule) {\r\n            array = this.seriesMatchingRules;\r\n        } else if (rule instanceof HP.ImageMatchingRule) {\r\n            array = this.imageMatchingRules;\r\n        }\r\n\r\n        removeFromArray(array, rule);\r\n    }\r\n};","/**\r\n * The ViewportStructure class represents the layout and layout properties that\r\n * Viewports are displayed in. ViewportStructure has a type, which corresponds to\r\n * a layout template, and a set of properties, which depend on the type.\r\n *\r\n * @type {ViewportStructure}\r\n */\r\nHP.ViewportStructure = class ViewportStructure {\r\n    constructor(type, properties) {\r\n        this.type = type;\r\n        this.properties = properties;\r\n    }\r\n\r\n    /**\r\n     * Occasionally the ViewportStructure class needs to be instantiated from a JavaScript Object.\r\n     * This function fills in a ViewportStructure with the Object data.\r\n     *\r\n     * @param input The ViewportStructure as a JavaScript Object, e.g. retrieved from MongoDB or JSON\r\n     */\r\n    fromObject(input) {\r\n        this.type = input.type;\r\n        this.properties = input.properties;\r\n    }\r\n\r\n    /**\r\n     * Retrieve the layout template name based on the layout type\r\n     *\r\n     * @returns {string}\r\n     */\r\n    getLayoutTemplateName() {\r\n        // Viewport structure can be updated later when we build more complex display layouts\r\n        switch (this.type) {\r\n            case 'grid':\r\n                return 'gridLayout';\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Retrieve the number of Viewports required for this layout\r\n     * given the layout type and properties\r\n     *\r\n     * @returns {string}\r\n     */\r\n    getNumViewports() {\r\n        // Viewport structure can be updated later when we build more complex display layouts\r\n        switch (this.type) {\r\n            case 'grid':\r\n                // For the typical grid layout, we only need to multiply rows by columns to\r\n                // obtain the number of viewports\r\n                return this.properties.rows * this.properties.columns;\r\n        }   \r\n    }\r\n};","import { Rule } from '../Rule';\r\n\r\n/**\r\n * The ImageMatchingRule class extends the Rule Class.\r\n *\r\n * At present it does not add any new methods or attributes\r\n * @type {ImageMatchingRule}\r\n */\r\nHP.ImageMatchingRule = class ImageMatchingRule extends Rule {};","import { Rule } from '../Rule';\r\n\r\n/**\r\n * The ProtocolMatchingRule Class extends the Rule Class.\r\n *\r\n * At present it does not add any new methods or attributes\r\n * @type {ProtocolMatchingRule}\r\n */\r\nHP.ProtocolMatchingRule = class ProtocolMatchingRule extends Rule {};","import { Rule } from '../Rule';\r\n\r\n/**\r\n * The SeriesMatchingRule Class extends the Rule Class.\r\n *\r\n * At present it does not add any new methods or attributes\r\n * @type {SeriesMatchingRule}\r\n */\r\nHP.SeriesMatchingRule = class SeriesMatchingRule extends Rule {};","import { Rule } from '../Rule';\r\n\r\n/**\r\n * The StudyMatchingRule Class extends the Rule Class.\r\n *\r\n * At present it does not add any new methods or attributes\r\n * @type {StudyMatchingRule}\r\n */\r\nHP.StudyMatchingRule = class StudyMatchingRule extends Rule {};\r\n","const comparators = [{\r\n    id: 'equals',\r\n    name: '= (Equals)',\r\n    validator: 'equals',\r\n    validatorOption: 'value',\r\n    description: 'The attribute must equal this value.'\r\n}, {\r\n    id: 'doesNotEqual',\r\n    name: '!= (Does not equal)',\r\n    validator: 'doesNotEqual',\r\n    validatorOption: 'value',\r\n    description: 'The attribute must not equal this value.'\r\n}, {\r\n    id: 'contains',\r\n    name: 'Contains',\r\n    validator: 'contains',\r\n    validatorOption: 'value',\r\n    description: 'The attribute must contain this value.'\r\n}, {\r\n    id: 'doesNotContain',\r\n    name: 'Does not contain',\r\n    validator: 'doesNotContain',\r\n    validatorOption: 'value',\r\n    description: 'The attribute must not contain this value.'\r\n}, {\r\n    id: 'startsWith',\r\n    name: 'Starts with',\r\n    validator: 'startsWith',\r\n    validatorOption: 'value',\r\n    description: 'The attribute must start with this value.'\r\n}, {\r\n    id: 'endsWith',\r\n    name: 'Ends with',\r\n    validator: 'endsWith',\r\n    validatorOption: 'value',\r\n    description: 'The attribute must end with this value.'\r\n}, {\r\n    id: 'onlyInteger',\r\n    name: 'Only Integers',\r\n    validator: 'numericality',\r\n    validatorOption: 'onlyInteger',\r\n    description: \"Real numbers won't be allowed.\"\r\n}, {\r\n    id: 'greaterThan',\r\n    name: '> (Greater than)',\r\n    validator: 'numericality',\r\n    validatorOption: 'greaterThan',\r\n    description: 'The attribute has to be greater than this value.'\r\n}, {\r\n    id: 'greaterThanOrEqualTo',\r\n    name: '>= (Greater than or equal to)',\r\n    validator: 'numericality',\r\n    validatorOption: 'greaterThanOrEqualTo',\r\n    description: 'The attribute has to be at least this value.'\r\n}, {\r\n    id: 'lessThanOrEqualTo',\r\n    name: '<= (Less than or equal to)',\r\n    validator: 'numericality',\r\n    validatorOption: 'lessThanOrEqualTo',\r\n    description: 'The attribute can be this value at the most.'\r\n}, {\r\n    id: 'lessThan',\r\n    name: '< (Less than)',\r\n    validator: 'numericality',\r\n    validatorOption: 'lessThan',\r\n    description: 'The attribute has to be less than this value.'\r\n}, {\r\n    id: 'odd',\r\n    name: 'Odd',\r\n    validator: 'numericality',\r\n    validatorOption: 'odd',\r\n    description: 'The attribute has to be odd.'\r\n}, {\r\n    id: 'even',\r\n    name: 'Even',\r\n    validator: 'numericality',\r\n    validatorOption: 'even',\r\n    description: 'The attribute has to be even.'\r\n}];\r\n\r\n// Immutable object\r\nObject.freeze(comparators);\r\n\r\nexport { comparators }","import { _ } from 'meteor/underscore';\r\n\r\n/**\r\n * Removes the first instance of an element from an array, if an equal value exists\r\n *\r\n * @param array\r\n * @param input\r\n *\r\n * @returns {boolean} Whether or not the element was found and removed\r\n */\r\nconst removeFromArray = (array, input) => {\r\n    // If the array is empty, stop here\r\n    if (!array ||\r\n        !array.length) {\r\n        return false;\r\n    }\r\n\r\n    array.forEach((value, index) => {\r\n        if (_.isEqual(value, input)) {\r\n            indexToRemove = index;\r\n            return false;\r\n        }\r\n    });\r\n\r\n    if (indexToRemove === void 0) {\r\n        return false;\r\n    }\r\n\r\n    array.splice(indexToRemove, 1);\r\n    return true;\r\n};\r\n\r\nexport { removeFromArray };","Meteor.publish('hangingprotocols', function() {\r\n    // TODO: filter by availableTo user\r\n    return HangingProtocols.find();\r\n});\r\n"]}